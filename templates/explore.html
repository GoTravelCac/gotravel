{% extends "base.html" %}

{% block title %}Explore Destinations - go.travel{% endblock %}
{% block description %}Discover amazing travel destinations with AI-powered insights, real-time weather, and interactive maps.{% endblock %}

{% block styles %}
/* Explore Page Styles */
.explore-header {
    background: linear-gradient(135deg, var(--accent-color) 0%, var(--primary-color) 100%);
    color: var(--white);
    padding: 3rem 0;
    text-align: center;
}

.explore-header h1 {
                   <div class="info-item">
                    <span class="info-icon">üõ°Ô∏è</span>
                    <div class="info-text">
                        <div class="info-label">Safety Rating</div>
                        <div class="info-value" title="${dest.safety_tips}">${getSafetyRating(dest.safety_rating)} (${dest.safety_rating}/5.0)</div>
                    </div>
                </div>amily: var(--font-heading);
    font-size: 3rem;
    margin-bottom: 1rem;
}

.filters {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 1rem;
    flex-wrap: wrap;
}

.filter-btn {
    padding: 0.5rem 1rem;
    border: 1px solid #e5e7eb;
    background: var(--white);
    border-radius: 25px;
    cursor: pointer;
    transition: none;
}

.filter-btn:hover,
.filter-btn:focus,
.filter-btn:active {
    padding: 0.5rem 1rem;
    border: 1px solid #e5e7eb;
    background: var(--white);
    transform: none;
    outline: none;
}

.filter-btn.active {
    background: var(--primary-color);
    color: var(--white);
    border-color: var(--primary-color);
}

.filter-btn.active:hover,
.filter-btn.active:focus,
.filter-btn.active:active {
    background: var(--primary-color);
    color: var(--white);
    border-color: var(--primary-color);
    transform: none;
    outline: none;
}

.temp-toggle {
    margin-left: auto;
}

.temp-switch {
    position: relative;
    display: inline-block;
    width: 80px;
    height: 34px;
}

.temp-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.temp-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--accent-color);
    border-radius: 34px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 8px;
    font-size: 12px;
    color: var(--white);
    font-weight: 600;
}

.temp-slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    border-radius: 50%;
}

input:checked + .temp-slider:before {
    transform: translateX(46px);
}

.temp-slider .temp-unit-left {
    opacity: 1;
}

.temp-slider .temp-unit-right {
    opacity: 0.5;
}

input:checked + .temp-slider .temp-unit-left {
    opacity: 0.5;
}

input:checked + .temp-slider .temp-unit-right {
    opacity: 1;
}

.destinations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 2rem;
    padding: 3rem 0;
}

.destination-card {
    background: var(--white);
    border-radius: var(--border-radius);
    overflow: hidden;
    box-shadow: var(--shadow-md);
    cursor: pointer;
    transition: none;
}

.destination-card:hover,
.destination-card:focus,
.destination-card:active {
    background: var(--white);
    box-shadow: var(--shadow-md);
    transform: none;
    transition: none;
    outline: none;
}

.destination-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: var(--white);
    padding: 1.5rem;
    text-align: center;
}

.destination-emoji {
    font-size: 3rem;
    margin-bottom: 0.5rem;
}

.destination-name {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.destination-country {
    opacity: 0.9;
    font-size: 0.9rem;
}

.destination-info {
    padding: 1.5rem;
}

.info-item {
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
    padding: 0.75rem;
    background: var(--background-color);
    border-radius: 8px;
}

.info-icon {
    font-size: 1.2rem;
    margin-right: 0.75rem;
    width: 25px;
}

.info-text {
    flex: 1;
}

.info-label {
    font-weight: 600;
    color: var(--text-color);
    font-size: 0.9rem;
}

.info-value {
    color: var(--text-light);
    font-size: 0.85rem;
}

.destination-description {
    margin-top: 1rem;
    color: var(--text-light);
    line-height: 1.6;
}

.destination-actions {
    padding: 1rem 1.5rem;
    border-top: 1px solid #e5e7eb;
    display: flex;
    gap: 0.5rem;
}

.action-btn {
    flex: 1;
    padding: 0.75rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: none;
}

.action-btn:hover,
.action-btn:focus,
.action-btn:active {
    transform: none;
    outline: none;
}

.btn-primary {
    background: var(--primary-color);
    color: var(--white);
}

.btn-primary:hover,
.btn-primary:focus,
.btn-primary:active {
    background: var(--primary-color);
    color: var(--white);
    transform: none;
    outline: none;
}

.btn-secondary {
    background: var(--background-color);
    color: var(--text-color);
    border: 1px solid #e5e7eb;
}

.btn-secondary:hover,
.btn-secondary:focus,
.btn-secondary:active {
    background: var(--background-color);
    color: var(--text-color);
    border: 1px solid #e5e7eb;
    transform: none;
    outline: none;
}





/* Responsive */
@media (max-width: 768px) {
    .explore-header h1 {
        font-size: 2.5rem;
    }
    
    .destinations-grid {
        grid-template-columns: 1fr;
        padding: 2rem 0;
    }
    
    .filters {
        flex-direction: column;
        align-items: center;
    }
    
    .destination-actions {
        flex-direction: column;
    }
}

/* Safety-related styles */
.safety-alert {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
    padding: 1rem;
    margin: 1rem 0;
    color: #856404;
}

.safety-tip {
    background: #d1ecf1;
    border: 1px solid #bee5eb;
    border-radius: 8px;
    padding: 0.75rem;
    margin: 0.5rem 0;
    color: #0c5460;
    font-size: 0.9rem;
}

.safety-rating-high {
    color: #2ed573;
}

.safety-rating-medium {
    color: #ffa502;
}

.safety-rating-low {
    color: #ff4757;
}

.copy-button {
    background: var(--secondary-color);
    color: var(--white);
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9rem;
    transition: none;
}

.copy-button:hover,
.copy-button:focus,
.copy-button:active {
    background: var(--secondary-color);
    color: var(--white);
    transform: none;
    outline: none;
}

/* Global button hover state removal */
button:hover,
button:focus,
button:active,
button:visited {
    transform: none !important;
    transition: none !important;
    outline: none !important;
}

button {
    transition: none !important;
}
{% endblock %}

{% block content %}
<!-- Explore Header -->
<section class="explore-header">
    <div class="container">
        <h1>Explore Destinations</h1>
        <p>Discover amazing places with AI-powered insights and real-time information</p>
    </div>
</section>

<!-- Filter Section -->
<section class="filter-section" style="background: var(--white); padding: 2rem 0; border-bottom: 1px solid #e5e7eb;">
    <div class="container">
        <div class="filters">
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="popular">Popular</button>
            <button class="filter-btn" data-filter="adventure">Adventure</button>
            <button class="filter-btn" data-filter="cultural">Cultural</button>
            <button class="filter-btn" data-filter="beach">Beach</button>
            <button class="filter-btn" data-filter="city">City</button>
            <button class="filter-btn" data-filter="nature">Nature</button>
            <div class="temp-toggle">
                <label class="temp-switch">
                    <input type="checkbox" id="tempToggle" onchange="toggleTemperatureUnit()">
                    <span class="temp-slider">
                        <span class="temp-unit-left">¬∞C</span>
                        <span class="temp-unit-right">¬∞F</span>
                    </span>
                </label>
            </div>
        </div>
    </div>
</section>

<!-- Safety Tips Section -->
<section class="safety-section" style="background: #f8f9fa; padding: 2rem 0; border-bottom: 1px solid #e5e7eb;">
    <div class="container">
        <div class="safety-alert">
            <h3 style="margin: 0 0 1rem 0; color: #856404;">üõ°Ô∏è Travel Safety Reminders</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                <div class="safety-tip">
                    üì± <strong>Emergency Contacts:</strong> Save local emergency numbers and embassy contacts
                </div>
                <div class="safety-tip">
                    üè• <strong>Travel Insurance:</strong> Ensure you have comprehensive travel insurance coverage
                </div>
                <div class="safety-tip">
                    üíä <strong>Health Precautions:</strong> Check vaccination requirements and bring necessary medications
                </div>
                <div class="safety-tip">
                    üí≥ <strong>Financial Security:</strong> Use multiple payment methods and inform your bank of travel plans
                </div>
            </div>
            <button class="copy-button" onclick="copySafetyTips()" style="margin-top: 1rem;">
                üìã Copy Safety Checklist
            </button>
        </div>
    </div>
</section>

<!-- Destinations Grid -->
<section class="destinations-section">
    <div class="container">
        <div id="destinationsGrid" class="destinations-grid">
            <!-- Destinations will be loaded here -->
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
// Global variables
let allDestinations = [];
let currentFilter = 'all';

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    loadDestinations();
    setupFilters();
});

// Load destinations from API
async function loadDestinations() {
    try {
        const response = await fetch('/api/destinations');
        const data = await response.json();
        
        if (data.destinations) {
            allDestinations = data.destinations;
            displayDestinations(allDestinations);
        } else {
            throw new Error('No destinations data received');
        }
    } catch (error) {
        console.error('Error loading destinations:', error);
        // Show error message to user
        const grid = document.getElementById('destinationsGrid');
        grid.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                <h3>Unable to load destinations</h3>
                <p>Please check your connection and try again.</p>
                <button onclick="loadDestinations()" class="cta-button" style="margin-top: 1rem;">
                    Try Again
                </button>
            </div>
        `;
    }
}

// Display destinations
function displayDestinations(destinations) {
    const grid = document.getElementById('destinationsGrid');
    
    // Store destinations for temperature conversion
    storeDestinations(destinations);
    
    if (destinations.length === 0) {
        grid.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                <h3>No destinations found</h3>
                <p>Try adjusting your search or filter criteria.</p>
            </div>
        `;
        return;
    }
    
    const cardsHTML = destinations.map(dest => {
        // Convert temperature in weather string
        let weatherDisplay = dest.weather;
        const temp = extractTemperature(dest.weather);
        if (temp !== null) {
            const convertedTemp = convertTemperature(temp);
            const description = dest.weather.replace(/\d+¬∞?[CF]?,?\s*/, '');
            weatherDisplay = `${convertedTemp}, ${description}`;
        }
        
        return `
        <div class="destination-card" onclick="viewDestination('${dest.name}', '${dest.country}')">
            <div class="destination-header">
                <div class="destination-emoji">${dest.emoji}</div>
                <div class="destination-name">${dest.name}</div>
                <div class="destination-country">${dest.country}</div>
            </div>
            <div class="destination-info">
                <div class="info-item">
                    <span class="info-icon">üå§Ô∏è</span>
                    <div class="info-text">
                        <div class="info-label">Weather</div>
                        <div class="info-value">${weatherDisplay}</div>
                    </div>
                </div>
                <div class="info-item">
                    <span class="info-icon">üïí</span>
                    <div class="info-text">
                        <div class="info-label">Timezone</div>
                        <div class="info-value">${dest.timezone}</div>
                    </div>
                </div>
                <div class="info-item">
                    <span class="info-icon">üõ°Ô∏è</span>
                    <div class="info-text">
                        <div class="info-label">Safety Rating</div>
                        <div class="info-value">${getSafetyRating(dest.safety_rating)} (${dest.safety_rating}/5.0)</div>
                    </div>
                </div>
                <div class="destination-description">
                    ${dest.description}
                </div>
            </div>
            <div class="destination-actions">
                <button class="action-btn btn-primary" onclick="event.stopPropagation(); planTrip('${dest.name}, ${dest.country}')">
                    Plan Trip
                </button>
                <button class="action-btn btn-secondary" onclick="event.stopPropagation(); learnMore('${dest.name}', '${dest.country}')">
                    Learn More
                </button>
            </div>
        </div>
        `;
    }).join('');
    
    grid.innerHTML = cardsHTML;
}

// Setup filters
function setupFilters() {
    const filterBtns = document.querySelectorAll('.filter-btn');
    filterBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            // Update active state
            filterBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // Filter destinations
            currentFilter = this.dataset.filter;
            filterDestinations();
        });
    });
}

// Filter destinations
function filterDestinations() {
    let filtered = allDestinations;
    
    if (currentFilter !== 'all') {
        filtered = allDestinations.filter(dest => 
            dest.category.includes(currentFilter)
        );
    }
    
    displayDestinations(filtered);
}

// View destination details (when clicking card)
function viewDestination(name, country) {
    // Navigate to trip planner with destination pre-filled
    window.location.href = `/planner?destination=${encodeURIComponent(name + ', ' + country)}`;
}

// Plan trip for destination
function planTrip(destination) {
    window.location.href = `/planner?destination=${encodeURIComponent(destination)}`;
}

// Learn more about destination (improved functionality)
async function learnMore(name, country) {
    try {
        // Fetch detailed destination information
        const response = await fetch(`/api/destination-details/${encodeURIComponent(name + ', ' + country)}`);
        const data = await response.json();
        
        if (data.details) {
            // Create a detailed info modal or popup
            const details = data.details;
            const attractions = data.attractions || [];
            
            let attractionsText = '';
            if (attractions.length > 0) {
                attractionsText = '\n\nTop Attractions:\n' + 
                    attractions.slice(0, 5).map(attraction => `‚Ä¢ ${attraction.name}`).join('\n');
            }
            
            const detailInfo = `
üèôÔ∏è ${name}, ${country}

üìç Location: ${details.location?.address || 'Information not available'}
üå°Ô∏è Current Weather: ${(() => {
                if (!details.weather || details.weather === 'Weather data unavailable') return 'Weather data unavailable';
                const temp = extractTemperature(details.weather);
                if (temp !== null) {
                    const convertedTemp = convertTemperature(temp);
                    const description = details.weather.replace(/\d+¬∞?[CF]?,?\s*/, '');
                    return `${convertedTemp}, ${description}`;
                }
                return details.weather;
            })()}
üïí Local Time: ${details.local_time || 'Time zone information unavailable'}
üõ°Ô∏è Safety Rating: ${details.safety_rating || 'Safety rating unavailable'}
‚ö†Ô∏è Safety Tips: ${details.safety_tips || 'Follow standard travel safety precautions'}

‚ÑπÔ∏è About:
${details.description || 'Discover the unique culture, attractions, and experiences this destination has to offer.'}
${attractionsText}

üéØ Ready to plan your trip? Click "Plan Trip" to get started!
            `;
            
            alert(detailInfo);
        } else {
            throw new Error('No destination details available');
        }
        
    } catch (error) {
        console.error('Error fetching destination details:', error);
        
        // Fallback: Show basic info from current data
        const destination = allDestinations.find(d => d.name === name && d.country === country);
        if (destination) {
            const basicInfo = `
üèôÔ∏è ${name}, ${country}

üå°Ô∏è Weather: ${(() => {
                const temp = extractTemperature(destination.weather);
                if (temp !== null) {
                    const convertedTemp = convertTemperature(temp);
                    const description = destination.weather.replace(/\d+¬∞?[CF]?,?\s*/, '');
                    return `${convertedTemp}, ${description}`;
                }
                return destination.weather;
            })()}
üïí Timezone: ${destination.timezone}
üõ°Ô∏è Safety Rating: ${destination.safety_rating}/5.0 stars
‚ö†Ô∏è Safety Tips: ${destination.safety_tips}

‚ÑπÔ∏è ${destination.description}

üéØ Ready to explore? Click "Plan Trip" to create your itinerary!
            `;
            alert(basicInfo);
        }
    }
}

// Temperature unit conversion
let isCelsius = true;
let currentDestinations = [];

function toggleTemperatureUnit() {
    const toggle = document.getElementById('tempToggle');
    isCelsius = !toggle.checked; // When checked, show Fahrenheit
    
    // Update all displayed temperatures
    updateTemperatureDisplay();
}

function convertTemperature(celsius) {
    if (isCelsius) {
        return Math.round(celsius) + '¬∞C';
    } else {
        const fahrenheit = (celsius * 9/5) + 32;
        return Math.round(fahrenheit) + '¬∞F';
    }
}

function extractTemperature(weatherString) {
    // Extract temperature from weather string like "25¬∞C, Sunny"
    const match = weatherString.match(/(\d+)¬∞?[CF]?/);
    return match ? parseInt(match[1]) : null;
}

function updateTemperatureDisplay() {
    if (currentDestinations.length === 0) return;
    
    // Re-display destinations with updated temperature units
    displayDestinations(currentDestinations);
}

// Store original destinations for temperature conversion
function storeDestinations(destinations) {
    currentDestinations = destinations;
}

// Safety rating display function
function getSafetyRating(rating) {
    const stars = '‚òÖ'.repeat(Math.floor(rating)) + '‚òÜ'.repeat(5 - Math.floor(rating));
    let color = '#ff4757'; // Red for low safety
    if (rating >= 4.5) color = '#2ed573'; // Green for high safety
    else if (rating >= 3.5) color = '#ffa502'; // Orange for medium safety
    
    return `<span style="color: ${color}; font-size: 1.1em;">${stars}</span>`;
}

// Copy safety tips to clipboard
function copySafetyTips() {
    const safetyChecklist = `
üõ°Ô∏è TRAVEL SAFETY CHECKLIST

üì± Emergency Contacts:
‚Ä¢ Save local emergency numbers (police, ambulance, fire)
‚Ä¢ Save your country's embassy/consulate contact information
‚Ä¢ Share your itinerary with trusted contacts back home

üè• Travel Insurance:
‚Ä¢ Purchase comprehensive travel insurance
‚Ä¢ Verify coverage includes medical emergencies and evacuation
‚Ä¢ Keep insurance documents accessible (physical and digital copies)

üíä Health Precautions:
‚Ä¢ Research vaccination requirements for your destination
‚Ä¢ Pack necessary prescription medications with extra supply
‚Ä¢ Bring a basic first aid kit
‚Ä¢ Research common health risks at your destination

üí≥ Financial Security:
‚Ä¢ Notify your bank and credit card companies of travel plans
‚Ä¢ Use multiple payment methods (cards, cash, mobile payments)
‚Ä¢ Keep backup cards and emergency cash in separate locations
‚Ä¢ Research local currency and exchange rates

üéí General Safety:
‚Ä¢ Research local laws, customs, and cultural norms
‚Ä¢ Register with your embassy if traveling abroad
‚Ä¢ Keep copies of important documents (passport, ID, insurance)
‚Ä¢ Stay aware of your surroundings and trust your instincts
‚Ä¢ Use reputable transportation and accommodation services

Made by go.travel - Safe and easy travels! üåç
    `;
    
    navigator.clipboard.writeText(safetyChecklist).then(() => {
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = '‚úÖ Copied!';
        button.style.background = '#2ed573';
        
        setTimeout(() => {
            button.textContent = originalText;
            button.style.background = '';
        }, 2000);
    }).catch(err => {
        console.error('Failed to copy safety tips:', err);
        alert('Safety checklist copied to clipboard!');
    });
}
{% endblock %}